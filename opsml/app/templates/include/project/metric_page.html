{% extends "base.html" %}


{% set model_status = none %}
{% set data_status = none %}
{% set runs_status = 'active' %}
{% set audit_status = none %}
{% include "include/navbar.html" %}

{% block title %}
  <title>Metrics</title>
{% endblock %}

{% block content %}
<body id="RunPage">
<div class="container" style="padding-top:65px;">
</div>

<br>
<h5 style="padding-top:10px; padding-left:40px;"><a href="/opsml/projects/list/?project={{ runcard["project_id"] }}&run_uid={{ runcard["uid"] }}">{{ runcard["name"] }}</a>: Metrics</h5>


{% if runcard["metrics"]|length > 0 %}


<form id="myForm" action="javascript:void(0);">

    <div style="padding-top:2px; padding-left:40px;">
        {% for metric in runcard["metrics"].keys() %}
            <div class="form-check">
                <label class="form-check-label" for="flexCheckDefault">{{ metric }}</label>
                <input class="form-check-input" type="checkbox" name={{ metric }} value={{ metric }} id="flexCheckDefault">
            </div>
        {% endfor %}
            
        <div class="form-check">
            <label class="form-check-label" for="flexCheckDefault">Bar Chart</label>
            <input class="form-check-input" type="checkbox" name="bar" value="true" id="flexCheckDefault">
        </div>
        <div class="form-check">
            <label class="form-check-label" for="flexCheckDefault">Step Chart</label>
            <input class="form-check-input" type="checkbox" name="step" value="true" id="flexCheckDefault">
        </div>
        
        <button onclick = "fun()" > Click Me </button>
    </div>
  </form> 

 <p> 
    <div id = "result"> </div> 
 </p>

 <div id = "barchart"> </div> 

{% endif %}

{% endblock %}

{% block scripts %}
<script>
    function fun() { 

        var selected_metrics = [];
        var selected_chart = [];
        var scores = [];
        $('#myForm input:checked').each(function() {

            if ($(this).attr('name') == 'bar' || $(this).attr('name') == 'step') {
                selected_chart.push($(this).attr('name'));
            }
            else {
                selected_metrics.push($(this).attr('name'));
            }
      
        });

        var metrics = {{ runcard["metrics"]|tojson }};

        for (var i = 0; i < selected_metrics.length; i++) {

            var metric = metrics[selected_metrics[i]];
            var last_metric = metric[metric.length - 1]
            scores.push(last_metric["value"]);
        }

        // get min and max values for y axis across all metrics
        // if min is greater than 0 set to 0
        // add padding to max
        minyValue = Math.min(Math.min(...scores), 0);
        maxyValue = Math.max(...scores) * 1.1;

       
        document.getElementById("result").innerHTML = `The function ${minyValue} ${maxyValue} is triggered !`; 
     } 
      
</script>
{% endblock %}

